<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Jump Rope Data</title>
	<link rel="stylesheet" href="/data.css">
</head>
<body>

<div class="logout">
  <button id="logout_btn">Logout</button>
</div>

<h1>Smart Jump Rope</h1>

<h1 id="username"></h1>


<script>
	fetch('/data/user', { credentials: 'include' })
  .then(res => {
    if (!res.ok) throw new Error('Not authorized');
    return res.json();
  })
  .then(data => {
    document.getElementById('username').textContent = `Welcome, ${data.username}!`;
  })
  .catch(err => {
    console.error(err);
  });
</script>




<!-- Bluetooth status -->
<div id="bleStatus">Disconnected</div>

<!-- Bluetooth controls -->
<div class="controls">
	<button id="btnConnect">Connect Bluetooth</button>
	<button id="btnStart" disabled>Start</button>
	<button id="btnStop" disabled>Stop</button>
</div>

<!-- Live data -->
<div class="data">
	<p><strong>Jump count:</strong> <span id="jumpCount">0</span></p>
	<p><strong>Heart rate:</strong> <span id="heartRate">-</span> bpm</p>
	<p><strong>Acceleration:</strong> <span id="accelMag">0</span></p>
</div>

<!-- Browser-side Bluetooth logic -->
<script src="/ble.js"></script>

<script>
  document.getElementById('logout_btn').addEventListener('click', function(event) {
    event.preventDefault();


		fetch('/logout', {
			method: 'POST',
			headers: { 'Content-Type': 'application/json' },
			credentials: 'include'
		})

		.then(response => {
			if (response.redirected) {
				window.location.href = response.url;
			}  
			else if(!response.ok){
				window.location.href = '/';
			}
		})

    })
</script>
</body>
</html>
